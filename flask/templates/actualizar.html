<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Definimos la codificación de caracteres y la escala inicial para dispositivos móviles -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualizar Empleado</title>
</head>

<body>
    <h1>Actualizar Empleado</h1>
    <form id="updateForm">
        <!-- Campo de entrada oculto para el ID del empleado -->
        <input type="hidden" id="employeeId" name="employeeId" value="{{ empleado._id }}">
        <label for="newName">Nuevo Nombre:</label>
        <!-- Campo de entrada para el nuevo nombre -->
        <input type="text" id="newName" name="newName" value="{{ empleado.Nombre }}" required>
        <br><br>
        <button type="submit">Actualizar Empleado</button>
        <!-- Botón para volver al índice -->
        <button id="redirectBtn" type="button" class="btn btn-primary">Volver al Índice</button>
    </form>

    <!-- Div para mostrar la respuesta de la actualización -->
    <div id="response"></div>

    <script>
        // Obtener el formulario y el div de respuesta por su ID
        const form = document.getElementById('updateForm');
        const responseDiv = document.getElementById('response');

        // Agregar un evento 'submit' al formulario
        form.addEventListener('submit', async function (e) {
            e.preventDefault(); // Evitar el comportamiento por defecto del formulario

            // Obtener el ID del empleado y el nuevo nombre
            const employeeId = document.getElementById('employeeId').value;
            const newName = document.getElementById('newName').value;

            try {
                // Realizar una solicitud PUT a la API para actualizar el empleado
                const response = await fetch(`/empleados/${employeeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nombre: newName })
                });

                // Obtener la respuesta en formato JSON
                const data = await response.json();
                // Mostrar la respuesta en el div de respuesta
                responseDiv.innerHTML = JSON.stringify(data, null, 2);

                // Redirigir al usuario a la página principal después de la actualización
                window.location.href = '/';
            } catch (error) {
                // Mostrar un mensaje de error en el div de respuesta en caso de error
                responseDiv.innerHTML = JSON.stringify({ error: 'Error al realizar la solicitud' }, null, 2);
            }
        });

        // Función para redirigir al índice al hacer clic en el botón 'Volver al Índice'
        function redirectToIndex() {
            window.location.href = '/';  // Cambia '/' a la ruta del índice de tu aplicación Flask si es diferente
        }

        // Agregar un evento 'click' al botón y llamar a la función de redirección
        document.getElementById('redirectBtn').addEventListener('click', redirectToIndex);
    </script>
</body>

</html>